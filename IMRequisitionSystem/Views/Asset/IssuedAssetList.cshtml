@model IMRequisitionSystem.Models.Assets.AssetsModel
@{
    ViewBag.Title = "IssuedAssetList";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<head>
    <base href="../../../">
    <meta charset="utf-8" />

    <link rel="canonical" href="https://keenthemes.com/metronic" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700" />
    <link href="~/lib/assets/plugins/global/plugins.bundle.css" rel="stylesheet" type="text/css" />
    <link href="~/lib/assets/plugins/custom/prismjs/prismjs.bundle.css" rel="stylesheet" type="text/css" />
    <link href="~/lib/assets/css/style.bundle.css" rel="stylesheet" type="text/css" />
    <link href="~/lib/assets/css/themes/layout/header/base/light.css" rel="stylesheet" type="text/css" />
    <link href="~/lib/assets/css/themes/layout/header/menu/light.css" rel="stylesheet" type="text/css" />
    <link href="~/lib/assets/css/themes/layout/brand/dark.css" rel="stylesheet" type="text/css" />
    <link href="~/lib/assets/css/themes/layout/aside/dark.css" rel="stylesheet" type="text/css" />
    <link rel="shortcut icon" href="~/lib/assets/media/logos/favicon.ico" />
</head>



<div class="card card-custom card-sticky" id="kt_page_sticky_card" style="border-radius:20px;">

    <div class="card-header">

        <div class="card-title d-flex justify-content-between align-items-center w-100">

            <div class="card-title">

                <h2 class="card-label roboto-bold font-weight-bolder font-size-h2-lg">

                    <span> ISSUED ASSET LIST</span>

                </h2>

            </div>

            <button onclick="location.href='@Url.Action("IssuedAssetReturnRequestListOnBehalf", "Return")'" class="btn btn-primary d-flex align-items-center">
                <span class="svg-icon menu-icon">
                    <!--begin::Svg Icon | path:~/lib/assets/media/svg/icons/Layout/Layout-left-panel-2.svg-->
                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                        <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                            <rect x="0" y="0" width="24" height="24" />
                            <path d="M10,4 L21,4 C21.5522847,4 22,4.44771525 22,5 L22,7 C22,7.55228475 21.5522847,8 21,8 L10,8 C9.44771525,8 9,7.55228475 9,7 L9,5 C9,4.44771525 9.44771525,4 10,4 Z M10,10 L21,10 C21.5522847,10 22,10.4477153 22,11 L22,13 C22,13.5522847 21.5522847,14 21,14 L10,14 C9.44771525,14 9,13.5522847 9,13 L9,11 C9,10.4477153 9.44771525,10 10,10 Z M10,16 L21,16 C21.5522847,16 22,16.4477153 22,17 L22,19 C22,19.5522847 21.5522847,20 21,20 L10,20 C9.44771525,20 9,19.5522847 9,19 L9,17 C9,16.4477153 9.44771525,16 10,16 Z" fill="#000000" />
                            <rect fill="#000000" opacity="0.3" x="2" y="4" width="5" height="16" rx="1" />
                        </g>
                    </svg>
                    <!--end::Svg Icon-->
                </span>
                ISSUED ASSET RETURN REQUEST LIST
            </button>

        </div>

    </div>

    <div class="card-body">
        <div class="card-body">

            <table class="table table-bordered table-checkable" id="IM_datatable">
                <thead>
                    <tr>
                        <th>Sl No:</th>
                        <th>Asset Serial No </th>
                        <th>Asset ID </th>
                        <th>Make </th>
                        <th>Model </th>
                        <th>Requisition ID</th>
                        <th>Issued Date </th>
                        <th>Issued To</th>
                        <th style="width: 100px;">Action</th>

                    </tr>
                </thead>
                <tbody>
                    @{ int i = 1; }
                    @foreach (var item in ViewBag.AssetMasterDataDD)
                    {
                        <tr>
                            <td>@i</td>
                            <td>@item.Asset_Sl_No</td>
                            <td>@item.Asset_Id_SAP</td>
                            <td>@item.AssetMakeNo</td>
                            <td>@item.AssetModelNo</td>
                            <td>@item.Requisition_No</td>
                            <td>@item.Asset_Issued_Datetime</td>
                            <td>@item.Issued_To</td>

                            <td>
                                <button class="btn btn-md btn-warning" data-toggle="modal" data-target="#returnRequest" onclick="ModalOpen('@Html.Raw(HttpUtility.JavaScriptStringEncode(item.Asset_Code_System))','@Html.Raw(HttpUtility.JavaScriptStringEncode(item.Issued_To))')">
                                    <span class="svg-icon svg-icon-white svg-icon-2x">
                                        <!--begin::Svg Icon | path:C:\wamp64\www\keenthemes\themes\metronic\theme\html\demo1\dist/../src/media/svg/icons\Code\Shift.svg--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                                            <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                                <rect x="0" y="0" width="24" height="24" />
                                                <path d="M12.5936684,18.0752333 L12.5936684,14.4063316 L18.5936684,14.4063316 L18.5936684,8.40633161 L12.5936684,8.40633161 L12.5936684,4.73208782 L5.92209543,11.3984411 L12.5936684,18.0752333 Z M14.5936684,6.40633161 L19.5936684,6.40633161 C20.1459531,6.40633161 20.5936684,6.85404686 20.5936684,7.40633161 L20.5936684,15.4063316 C20.5936684,15.9586164 20.1459531,16.4063316 19.5936684,16.4063316 L14.5936684,16.4063316 L14.5936684,21.0946697 C14.5936684,21.2936837 14.5145702,21.484538 14.3737911,21.6252071 C14.0807833,21.9179858 13.6059096,21.9178001 13.313131,21.6247924 L3.62379074,11.9278722 C3.33101216,11.6348644 3.33119799,11.1599907 3.6242058,10.8672121 L13.3135459,1.18545264 C13.4541812,1.04492729 13.6448577,0.965990217 13.8436684,0.965990217 C14.257882,0.965990217 14.5936684,1.30177665 14.5936684,1.71599022 L14.5936684,6.40633161 Z" fill="#000000" fill-rule="nonzero" transform="translate(11.998998, 11.405330) scale(-1, 1) rotate(-270.000000) translate(-11.998998, -11.405330) " />
                                            </g>
                                        </svg><!--end::Svg Icon-->
                                    </span>
                                    Return
                                </button>
                            </td>

                        </tr>
                        i++;
                    }
                </tbody>
            </table>

        </div>
    </div>



</div>


<div class="modal fade" id="returnRequest" tabindex="-1" role="dialog" aria-labelledby="staticBackdrop" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title font-weight-bold">REASON FOR RETURNING THE ASSET</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <i aria-hidden="true" class="ki ki-close"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-lg-12">
                        <label class="font-weight-bold">Reason:</label>
                        <div class="form-group">
                            @Html.TextAreaFor(model => model.Return_Comment, new { @class = "form-control", @placeholder = "Enter Remarks", autocomplete = "off", rows = "4", cols = "50" })

                        </div>
                        <span class="form-text" style="color:red;">This is a required field.</span>
                    </div>
                </div>

                <div class="row">
                    <div class="col-lg-6">
                        <label class="font-weight-bolder">Select Asset Condition:</label>
                        @Html.DropDownListFor(model => model.asset_Physical_Condition,
                        new SelectList(ViewBag.AssetConditions, "Value", "Text", Model?.asset_Physical_Condition),
                        "Select Condition", new { @class = "form-control select2", @style = "width:100%" })

                        <span class="form-text text-muted">Select the asset condition to be returned.</span>
                    </div>

                    <div class="col-lg-6">
                        <label class="font-weight-bolder">Return on behalf of:</label>

                        @Html.EditorFor(model => model.Issued_To, new { htmlAttributes = new { @type = "text", @class = "form-control", @placeholder = "Enter Remarks", autocomplete = "off" ,id="IssuedTo"} })


                        <span class="form-text text-muted">Returning asset on behalf of.</span>
                    </div>
                    @Html.HiddenFor(model => model.Asset_Code_System)
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="ReturnRequest()" id="ReturnRequest">Submit</button>
            </div>
        </div>
    </div>
</div>
<!-- Modal-->


<script src="~/lib/assets/plugins/global/plugins.bundle.js"></script>
<script src="~/lib/assets/plugins/custom/prismjs/prismjs.bundle.js"></script>
<script src="~/lib/assets/js/scripts.bundle.js"></script>
<script src="~/lib/assets/plugins/custom/datatables/datatables.bundle.js"></script>
<script>
    var table = $('#IM_datatable');
    table.DataTable({
        responsive: true,
        pagingType: 'full_numbers',
        order: [],
        dom: 'lBfrtip',
        buttons: [
            'copyHtml5',
            'excelHtml5',
            'csvHtml5',
            'pdfHtml5'
        ],
        lengthMenu: [
            [10, 25, 50, 100, -1],
            ['10 rows', '25 rows', '50 rows', '100 rows', 'Show all']
        ]
    });
    table.init();
</script>

<script>
    $('#asset_Physical_Condition').select2({
        placeholder: "Select Asset Condition"
    });
</script>

<script>
    var globalAsset_Code_System;
    function ModalOpen(asset_Code_System, Issued_To ) {
        debugger;
        globalAsset_Code_System = asset_Code_System;
        $('#IssuedTo').val(Issued_To);
        /* console.log("Requisition No:", requisitionNo); */
        $('#returnRequest').modal('show');  // Open the modal
    }

    function ReturnRequest() {
    debugger;
    var btnID = "returnRequest";
    var Asset_Code_System = globalAsset_Code_System;
    var asset_Physical_Condition = $("#asset_Physical_Condition").val();
    var Return_Comment = $("#Return_Comment").val();


    if (asset_Physical_Condition == "" || asset_Physical_Condition == null) {
        showSwalToast("Select asset Condition ." ,"error");
    return;
    }

    $("#" + btnID).attr("disabled", true);
    $("#" + btnID).html("Please Wait..");

    var requisitionRequestModel = {};
    requisitionRequestModel.Return_Comment = Return_Comment;
    requisitionRequestModel.asset_Physical_Condition = asset_Physical_Condition;
    requisitionRequestModel.Asset_Code_System = Asset_Code_System;



    $.ajax({
    url: '@Url.Action("RequisitionReturnRequestFRomIssuer", "Return")',
    type: 'POST',
    data: { requisitionRequestModel: requisitionRequestModel },
    success: function (data) {

    if (data.redirectUrl != '') {
    location.href = data.redirectUrl;
    } else {
    $("#" + btnID).attr("disabled", false);
    $("#" + btnID).html("Submit");
    }
    },
    error: function (jqXHR, textStatus, errorThrown) {

    $("#" + btnID).attr("disabled", false);
    $("#" + btnID).html("Submit");

    toastr.error("Failed to Issue. Try again.");
    }
    });
    }
</script>





